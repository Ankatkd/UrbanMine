{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ankao\\\\OneDrive\\\\Desktop\\\\nilesh\\\\E-waste\\\\frontend\\\\src\\\\components\\\\ProtectedRoute.js\";\nimport React from 'react';\nimport { Navigate, Outlet } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProtectedRoute = ({\n  allowedRoles\n}) => {\n  // Check for user login\n  const userToken = localStorage.getItem('token');\n  const userRole = localStorage.getItem('role'); // Expected to be lowercase (e.g., \"individual\")\n\n  // Check for worker login\n  const workerToken = localStorage.getItem('workerToken');\n  const workerRole = localStorage.getItem('workerRole'); // Expected to be \"worker\"\n\n  let isAuthenticated = false;\n  let actualRole = null;\n\n  // Prioritize worker login check if you have separate tokens\n  if (workerToken && workerRole === 'worker') {\n    // Check for lowercase 'worker' role\n    isAuthenticated = true;\n    actualRole = 'worker';\n  } else if (userToken && userRole) {\n    isAuthenticated = true;\n    actualRole = userRole; // This will be the lowercase role from localStorage\n  }\n  if (!isAuthenticated) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 16\n    }, this);\n  }\n\n  // If isAuthenticated, but specific roles are required\n  if (allowedRoles && allowedRoles.length > 0) {\n    // Ensure actualRole exists and is included in the allowedRoles array (all lowercase)\n    if (!actualRole || !allowedRoles.includes(actualRole)) {\n      console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\n\n      // --- SMART REDIRECTION (Crucial for worker issue) ---\n      // If the authenticated user IS a worker, redirect them to THEIR dashboard\n      if (actualRole === 'worker') {\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/worker/dashboard\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 38,\n          columnNumber: 24\n        }, this);\n      }\n      // If the user has a regular user role (individual, commercial, charity)\n      // but is trying to access a route they don't have permission for (e.g., individual trying to access commercial-dashboard)\n      // send them to THEIR appropriate default dashboard.\n      else if (['individual', 'commercial', 'charity'].includes(actualRole)) {\n        // All lowercase roles here\n        if (actualRole === 'commercial') {\n          return /*#__PURE__*/_jsxDEV(Navigate, {\n            to: \"/commercial-dashboard\",\n            replace: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 45,\n            columnNumber: 28\n          }, this);\n        }\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/profile\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 47,\n          columnNumber: 24\n        }, this); // Default for individual/charity\n      }\n      // Fallback for any other unexpected role or scenario\n      return /*#__PURE__*/_jsxDEV(Navigate, {\n        to: \"/\",\n        replace: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 20\n      }, this); // Send to home\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 12\n  }, this);\n};\n_c = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["React","Navigate","Outlet","jsxDEV","_jsxDEV","ProtectedRoute","allowedRoles","userToken","localStorage","getItem","userRole","workerToken","workerRole","isAuthenticated","actualRole","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","length","includes","console","warn","join","_c","$RefreshReg$"],"sources":["C:/Users/ankao/OneDrive/Desktop/nilesh/E-waste/frontend/src/components/ProtectedRoute.js"],"sourcesContent":["import React from 'react';\r\nimport { Navigate, Outlet } from 'react-router-dom';\r\n\r\nconst ProtectedRoute = ({ allowedRoles }) => {\r\n    // Check for user login\r\n    const userToken = localStorage.getItem('token');\r\n    const userRole = localStorage.getItem('role'); // Expected to be lowercase (e.g., \"individual\")\r\n\r\n    // Check for worker login\r\n    const workerToken = localStorage.getItem('workerToken');\r\n    const workerRole = localStorage.getItem('workerRole'); // Expected to be \"worker\"\r\n\r\n    let isAuthenticated = false;\r\n    let actualRole = null;\r\n\r\n    // Prioritize worker login check if you have separate tokens\r\n    if (workerToken && workerRole === 'worker') { // Check for lowercase 'worker' role\r\n        isAuthenticated = true;\r\n        actualRole = 'worker';\r\n    } else if (userToken && userRole) {\r\n        isAuthenticated = true;\r\n        actualRole = userRole; // This will be the lowercase role from localStorage\r\n    }\r\n\r\n    if (!isAuthenticated) {\r\n        return <Navigate to=\"/login\" replace />;\r\n    }\r\n\r\n    // If isAuthenticated, but specific roles are required\r\n    if (allowedRoles && allowedRoles.length > 0) {\r\n        // Ensure actualRole exists and is included in the allowedRoles array (all lowercase)\r\n        if (!actualRole || !allowedRoles.includes(actualRole)) {\r\n            console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\r\n\r\n            // --- SMART REDIRECTION (Crucial for worker issue) ---\r\n            // If the authenticated user IS a worker, redirect them to THEIR dashboard\r\n            if (actualRole === 'worker') {\r\n                return <Navigate to=\"/worker/dashboard\" replace />;\r\n            }\r\n            // If the user has a regular user role (individual, commercial, charity)\r\n            // but is trying to access a route they don't have permission for (e.g., individual trying to access commercial-dashboard)\r\n            // send them to THEIR appropriate default dashboard.\r\n            else if (['individual', 'commercial', 'charity'].includes(actualRole)) { // All lowercase roles here\r\n                if (actualRole === 'commercial') {\r\n                    return <Navigate to=\"/commercial-dashboard\" replace />;\r\n                }\r\n                return <Navigate to=\"/profile\" replace />; // Default for individual/charity\r\n            }\r\n            // Fallback for any other unexpected role or scenario\r\n            return <Navigate to=\"/\" replace />; // Send to home\r\n        }\r\n    }\r\n\r\n    return <Outlet />;\r\n};\r\n\r\nexport default ProtectedRoute;"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,EAAEC,MAAM,QAAQ,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEpD,MAAMC,cAAc,GAAGA,CAAC;EAAEC;AAAa,CAAC,KAAK;EACzC;EACA,MAAMC,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC/C,MAAMC,QAAQ,GAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;;EAE/C;EACA,MAAME,WAAW,GAAGH,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EACvD,MAAMG,UAAU,GAAGJ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;;EAEvD,IAAII,eAAe,GAAG,KAAK;EAC3B,IAAIC,UAAU,GAAG,IAAI;;EAErB;EACA,IAAIH,WAAW,IAAIC,UAAU,KAAK,QAAQ,EAAE;IAAE;IAC1CC,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAG,QAAQ;EACzB,CAAC,MAAM,IAAIP,SAAS,IAAIG,QAAQ,EAAE;IAC9BG,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAGJ,QAAQ,CAAC,CAAC;EAC3B;EAEA,IAAI,CAACG,eAAe,EAAE;IAClB,oBAAOT,OAAA,CAACH,QAAQ;MAACc,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAC3C;;EAEA;EACA,IAAId,YAAY,IAAIA,YAAY,CAACe,MAAM,GAAG,CAAC,EAAE;IACzC;IACA,IAAI,CAACP,UAAU,IAAI,CAACR,YAAY,CAACgB,QAAQ,CAACR,UAAU,CAAC,EAAE;MACnDS,OAAO,CAACC,IAAI,CAAC,6BAA6BV,UAAU,2BAA2BR,YAAY,CAACmB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;;MAEzG;MACA;MACA,IAAIX,UAAU,KAAK,QAAQ,EAAE;QACzB,oBAAOV,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,mBAAmB;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MACtD;MACA;MACA;MACA;MAAA,KACK,IAAI,CAAC,YAAY,EAAE,YAAY,EAAE,SAAS,CAAC,CAACE,QAAQ,CAACR,UAAU,CAAC,EAAE;QAAE;QACrE,IAAIA,UAAU,KAAK,YAAY,EAAE;UAC7B,oBAAOV,OAAA,CAACH,QAAQ;YAACc,EAAE,EAAC,uBAAuB;YAACC,OAAO;UAAA;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAC1D;QACA,oBAAOhB,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,UAAU;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,CAAC,CAAC;MAC/C;MACA;MACA,oBAAOhB,OAAA,CAACH,QAAQ;QAACc,EAAE,EAAC,GAAG;QAACC,OAAO;MAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,CAAC,CAAC;IACxC;EACJ;EAEA,oBAAOhB,OAAA,CAACF,MAAM;IAAAe,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAE,CAAC;AACrB,CAAC;AAACM,EAAA,GAnDIrB,cAAc;AAqDpB,eAAeA,cAAc;AAAC,IAAAqB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}