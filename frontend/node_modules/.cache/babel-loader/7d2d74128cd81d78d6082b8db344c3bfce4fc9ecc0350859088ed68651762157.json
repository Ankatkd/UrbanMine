{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ankao\\\\OneDrive\\\\Desktop\\\\nilesh\\\\E-waste\\\\frontend\\\\src\\\\components\\\\ProtectedRoute.js\";\n// src/components/ProtectedRoute.js\nimport React from 'react';\nimport { Navigate, Outlet } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProtectedRoute = ({\n  allowedRoles\n}) => {\n  // Check for user login (assuming your user login stores 'token' and 'role')\n  const userToken = localStorage.getItem('token'); // Assuming general user token is 'token'\n  const userRole = localStorage.getItem('role'); // Assuming general user role is 'role'\n\n  // Check for worker login (assuming worker login stores 'workerToken' and 'workerRole')\n  const workerToken = localStorage.getItem('workerToken');\n  const workerRole = localStorage.getItem('workerRole');\n  let isAuthenticated = false;\n  let actualRole = null;\n\n  // Prioritize worker authentication if a worker token exists\n  if (workerToken && workerRole === 'WORKER') {\n    // Check for explicit 'WORKER' role\n    isAuthenticated = true;\n    actualRole = 'WORKER';\n  } else if (userToken && userRole) {\n    // Otherwise, check for general user token\n    isAuthenticated = true;\n    actualRole = userRole; // Use the specific role for general users\n  }\n  if (!isAuthenticated) {\n    // If not authenticated at all, redirect to a generic login (or home)\n    // You might want to choose between '/login' or '/' based on your app's flow\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 16\n    }, this);\n  }\n\n  // If isAuthenticated, but specific roles are required\n  if (allowedRoles && allowedRoles.length > 0) {\n    if (!actualRole || !allowedRoles.includes(actualRole)) {\n      // User is authenticated but doesn't have the required role\n      console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\n\n      // --- SMART REDIRECTION BASED ON ROLE ---\n      if (actualRole === 'WORKER') {\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/worker/dashboard\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 40,\n          columnNumber: 24\n        }, this);\n      } else if (['INDIVIDUAL', 'COMMERCIAL', 'CHARITY'].includes(actualRole)) {\n        // If a regular user tries to access a worker route, send them to their dashboard\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/profile\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 43,\n          columnNumber: 24\n        }, this); // Or their specific user dashboard\n      }\n      // Fallback for unexpected roles or if no specific dashboard exists\n      return /*#__PURE__*/_jsxDEV(Navigate, {\n        to: \"/\",\n        replace: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 20\n      }, this); // Send to home\n    }\n  }\n\n  // If authenticated and roles match (or no specific roles required), render children\n  return /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 51,\n    columnNumber: 12\n  }, this);\n};\n_c = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["React","Navigate","Outlet","jsxDEV","_jsxDEV","ProtectedRoute","allowedRoles","userToken","localStorage","getItem","userRole","workerToken","workerRole","isAuthenticated","actualRole","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","length","includes","console","warn","join","_c","$RefreshReg$"],"sources":["C:/Users/ankao/OneDrive/Desktop/nilesh/E-waste/frontend/src/components/ProtectedRoute.js"],"sourcesContent":["// src/components/ProtectedRoute.js\r\nimport React from 'react';\r\nimport { Navigate, Outlet } from 'react-router-dom';\r\n\r\nconst ProtectedRoute = ({ allowedRoles }) => {\r\n    // Check for user login (assuming your user login stores 'token' and 'role')\r\n    const userToken = localStorage.getItem('token'); // Assuming general user token is 'token'\r\n    const userRole = localStorage.getItem('role');   // Assuming general user role is 'role'\r\n\r\n    // Check for worker login (assuming worker login stores 'workerToken' and 'workerRole')\r\n    const workerToken = localStorage.getItem('workerToken');\r\n    const workerRole = localStorage.getItem('workerRole');\r\n\r\n    let isAuthenticated = false;\r\n    let actualRole = null;\r\n\r\n    // Prioritize worker authentication if a worker token exists\r\n    if (workerToken && workerRole === 'WORKER') { // Check for explicit 'WORKER' role\r\n        isAuthenticated = true;\r\n        actualRole = 'WORKER';\r\n    } else if (userToken && userRole) { // Otherwise, check for general user token\r\n        isAuthenticated = true;\r\n        actualRole = userRole; // Use the specific role for general users\r\n    }\r\n\r\n    if (!isAuthenticated) {\r\n        // If not authenticated at all, redirect to a generic login (or home)\r\n        // You might want to choose between '/login' or '/' based on your app's flow\r\n        return <Navigate to=\"/login\" replace />;\r\n    }\r\n\r\n    // If isAuthenticated, but specific roles are required\r\n    if (allowedRoles && allowedRoles.length > 0) {\r\n        if (!actualRole || !allowedRoles.includes(actualRole)) {\r\n            // User is authenticated but doesn't have the required role\r\n            console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\r\n\r\n            // --- SMART REDIRECTION BASED ON ROLE ---\r\n            if (actualRole === 'WORKER') {\r\n                return <Navigate to=\"/worker/dashboard\" replace />;\r\n            } else if (['INDIVIDUAL', 'COMMERCIAL', 'CHARITY'].includes(actualRole)) {\r\n                // If a regular user tries to access a worker route, send them to their dashboard\r\n                return <Navigate to=\"/profile\" replace />; // Or their specific user dashboard\r\n            }\r\n            // Fallback for unexpected roles or if no specific dashboard exists\r\n            return <Navigate to=\"/\" replace />; // Send to home\r\n        }\r\n    }\r\n\r\n    // If authenticated and roles match (or no specific roles required), render children\r\n    return <Outlet />;\r\n};\r\n\r\nexport default ProtectedRoute;"],"mappings":";AAAA;AACA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,EAAEC,MAAM,QAAQ,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEpD,MAAMC,cAAc,GAAGA,CAAC;EAAEC;AAAa,CAAC,KAAK;EACzC;EACA,MAAMC,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC;EACjD,MAAMC,QAAQ,GAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAG;;EAEjD;EACA,MAAME,WAAW,GAAGH,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EACvD,MAAMG,UAAU,GAAGJ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC;EAErD,IAAII,eAAe,GAAG,KAAK;EAC3B,IAAIC,UAAU,GAAG,IAAI;;EAErB;EACA,IAAIH,WAAW,IAAIC,UAAU,KAAK,QAAQ,EAAE;IAAE;IAC1CC,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAG,QAAQ;EACzB,CAAC,MAAM,IAAIP,SAAS,IAAIG,QAAQ,EAAE;IAAE;IAChCG,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAGJ,QAAQ,CAAC,CAAC;EAC3B;EAEA,IAAI,CAACG,eAAe,EAAE;IAClB;IACA;IACA,oBAAOT,OAAA,CAACH,QAAQ;MAACc,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAC3C;;EAEA;EACA,IAAId,YAAY,IAAIA,YAAY,CAACe,MAAM,GAAG,CAAC,EAAE;IACzC,IAAI,CAACP,UAAU,IAAI,CAACR,YAAY,CAACgB,QAAQ,CAACR,UAAU,CAAC,EAAE;MACnD;MACAS,OAAO,CAACC,IAAI,CAAC,6BAA6BV,UAAU,2BAA2BR,YAAY,CAACmB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;;MAEzG;MACA,IAAIX,UAAU,KAAK,QAAQ,EAAE;QACzB,oBAAOV,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,mBAAmB;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MACtD,CAAC,MAAM,IAAI,CAAC,YAAY,EAAE,YAAY,EAAE,SAAS,CAAC,CAACE,QAAQ,CAACR,UAAU,CAAC,EAAE;QACrE;QACA,oBAAOV,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,UAAU;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,CAAC,CAAC;MAC/C;MACA;MACA,oBAAOhB,OAAA,CAACH,QAAQ;QAACc,EAAE,EAAC,GAAG;QAACC,OAAO;MAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,CAAC,CAAC;IACxC;EACJ;;EAEA;EACA,oBAAOhB,OAAA,CAACF,MAAM;IAAAe,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAE,CAAC;AACrB,CAAC;AAACM,EAAA,GA/CIrB,cAAc;AAiDpB,eAAeA,cAAc;AAAC,IAAAqB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}