{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ankao\\\\OneDrive\\\\Desktop\\\\nilesh\\\\E-waste\\\\frontend\\\\src\\\\components\\\\ProtectedRoute.js\";\nimport React from 'react';\nimport { Navigate, Outlet } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProtectedRoute = ({\n  allowedRoles\n}) => {\n  // Retrieve authentication details from localStorage for both users and workers\n  const userToken = localStorage.getItem('token');\n  const userRole = localStorage.getItem('role'); // Expected to be lowercase (e.g., \"individual\", \"commercial\", \"charity\")\n\n  const workerToken = localStorage.getItem('workerToken');\n  const workerRole = localStorage.getItem('workerRole'); // Expected to be \"worker\"\n\n  let isAuthenticated = false;\n  let actualRole = null;\n\n  // Determine authentication status and actual role based on available tokens\n  // Worker login is checked first if there's a possibility of overlapping tokens or roles\n  if (workerToken && workerRole === 'worker') {\n    isAuthenticated = true;\n    actualRole = 'worker';\n  } else if (userToken && userRole) {\n    // Check for user token and role\n    isAuthenticated = true;\n    actualRole = userRole;\n  }\n\n  // If neither user nor worker is authenticated, redirect to login page\n  if (!isAuthenticated) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/login\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 16\n    }, this);\n  }\n\n  // If authentication is successful, but specific roles are required for the route\n  if (allowedRoles && allowedRoles.length > 0) {\n    // Check if the authenticated user's role is included in the allowed roles\n    if (!actualRole || !allowedRoles.includes(actualRole)) {\n      console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\n\n      // Smart Redirection: Redirect authenticated users to their appropriate dashboard\n      // based on their actual role if they try to access a forbidden route.\n      if (actualRole === 'worker') {\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/worker/dashboard\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 39,\n          columnNumber: 24\n        }, this);\n      }\n      // For regular user roles\n      else if (['individual', 'commercial', 'charity'].includes(actualRole)) {\n        if (actualRole === 'commercial') {\n          return /*#__PURE__*/_jsxDEV(Navigate, {\n            to: \"/commercial-dashboard\",\n            replace: true\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 44,\n            columnNumber: 28\n          }, this);\n        }\n        return /*#__PURE__*/_jsxDEV(Navigate, {\n          to: \"/profile\",\n          replace: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 46,\n          columnNumber: 24\n        }, this); // Default for individual/charity users\n      }\n      // Fallback for any other unexpected role or scenario (e.g., if actualRole is null for some reason)\n      return /*#__PURE__*/_jsxDEV(Navigate, {\n        to: \"/\",\n        replace: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 20\n      }, this); // Send to home page\n    }\n  }\n\n  // If authenticated and authorized (role matches allowedRoles or no specific roles required), render the child routes\n  return /*#__PURE__*/_jsxDEV(Outlet, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 12\n  }, this);\n};\n_c = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["React","Navigate","Outlet","jsxDEV","_jsxDEV","ProtectedRoute","allowedRoles","userToken","localStorage","getItem","userRole","workerToken","workerRole","isAuthenticated","actualRole","to","replace","fileName","_jsxFileName","lineNumber","columnNumber","length","includes","console","warn","join","_c","$RefreshReg$"],"sources":["C:/Users/ankao/OneDrive/Desktop/nilesh/E-waste/frontend/src/components/ProtectedRoute.js"],"sourcesContent":["import React from 'react';\r\nimport { Navigate, Outlet } from 'react-router-dom';\r\n\r\nconst ProtectedRoute = ({ allowedRoles }) => {\r\n    // Retrieve authentication details from localStorage for both users and workers\r\n    const userToken = localStorage.getItem('token');\r\n    const userRole = localStorage.getItem('role'); // Expected to be lowercase (e.g., \"individual\", \"commercial\", \"charity\")\r\n\r\n    const workerToken = localStorage.getItem('workerToken');\r\n    const workerRole = localStorage.getItem('workerRole'); // Expected to be \"worker\"\r\n\r\n    let isAuthenticated = false;\r\n    let actualRole = null;\r\n\r\n    // Determine authentication status and actual role based on available tokens\r\n    // Worker login is checked first if there's a possibility of overlapping tokens or roles\r\n    if (workerToken && workerRole === 'worker') {\r\n        isAuthenticated = true;\r\n        actualRole = 'worker';\r\n    } else if (userToken && userRole) { // Check for user token and role\r\n        isAuthenticated = true;\r\n        actualRole = userRole;\r\n    }\r\n\r\n    // If neither user nor worker is authenticated, redirect to login page\r\n    if (!isAuthenticated) {\r\n        return <Navigate to=\"/login\" replace />;\r\n    }\r\n\r\n    // If authentication is successful, but specific roles are required for the route\r\n    if (allowedRoles && allowedRoles.length > 0) {\r\n        // Check if the authenticated user's role is included in the allowed roles\r\n        if (!actualRole || !allowedRoles.includes(actualRole)) {\r\n            console.warn(`Access denied: User role '${actualRole}' not in allowed roles: ${allowedRoles.join(', ')}`);\r\n\r\n            // Smart Redirection: Redirect authenticated users to their appropriate dashboard\r\n            // based on their actual role if they try to access a forbidden route.\r\n            if (actualRole === 'worker') {\r\n                return <Navigate to=\"/worker/dashboard\" replace />;\r\n            }\r\n            // For regular user roles\r\n            else if (['individual', 'commercial', 'charity'].includes(actualRole)) {\r\n                if (actualRole === 'commercial') {\r\n                    return <Navigate to=\"/commercial-dashboard\" replace />;\r\n                }\r\n                return <Navigate to=\"/profile\" replace />; // Default for individual/charity users\r\n            }\r\n            // Fallback for any other unexpected role or scenario (e.g., if actualRole is null for some reason)\r\n            return <Navigate to=\"/\" replace />; // Send to home page\r\n        }\r\n    }\r\n\r\n    // If authenticated and authorized (role matches allowedRoles or no specific roles required), render the child routes\r\n    return <Outlet />;\r\n};\r\n\r\nexport default ProtectedRoute;"],"mappings":";AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,EAAEC,MAAM,QAAQ,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEpD,MAAMC,cAAc,GAAGA,CAAC;EAAEC;AAAa,CAAC,KAAK;EACzC;EACA,MAAMC,SAAS,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC/C,MAAMC,QAAQ,GAAGF,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC;;EAE/C,MAAME,WAAW,GAAGH,YAAY,CAACC,OAAO,CAAC,aAAa,CAAC;EACvD,MAAMG,UAAU,GAAGJ,YAAY,CAACC,OAAO,CAAC,YAAY,CAAC,CAAC,CAAC;;EAEvD,IAAII,eAAe,GAAG,KAAK;EAC3B,IAAIC,UAAU,GAAG,IAAI;;EAErB;EACA;EACA,IAAIH,WAAW,IAAIC,UAAU,KAAK,QAAQ,EAAE;IACxCC,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAG,QAAQ;EACzB,CAAC,MAAM,IAAIP,SAAS,IAAIG,QAAQ,EAAE;IAAE;IAChCG,eAAe,GAAG,IAAI;IACtBC,UAAU,GAAGJ,QAAQ;EACzB;;EAEA;EACA,IAAI,CAACG,eAAe,EAAE;IAClB,oBAAOT,OAAA,CAACH,QAAQ;MAACc,EAAE,EAAC,QAAQ;MAACC,OAAO;IAAA;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAC3C;;EAEA;EACA,IAAId,YAAY,IAAIA,YAAY,CAACe,MAAM,GAAG,CAAC,EAAE;IACzC;IACA,IAAI,CAACP,UAAU,IAAI,CAACR,YAAY,CAACgB,QAAQ,CAACR,UAAU,CAAC,EAAE;MACnDS,OAAO,CAACC,IAAI,CAAC,6BAA6BV,UAAU,2BAA2BR,YAAY,CAACmB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC;;MAEzG;MACA;MACA,IAAIX,UAAU,KAAK,QAAQ,EAAE;QACzB,oBAAOV,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,mBAAmB;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC;MACtD;MACA;MAAA,KACK,IAAI,CAAC,YAAY,EAAE,YAAY,EAAE,SAAS,CAAC,CAACE,QAAQ,CAACR,UAAU,CAAC,EAAE;QACnE,IAAIA,UAAU,KAAK,YAAY,EAAE;UAC7B,oBAAOV,OAAA,CAACH,QAAQ;YAACc,EAAE,EAAC,uBAAuB;YAACC,OAAO;UAAA;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC;QAC1D;QACA,oBAAOhB,OAAA,CAACH,QAAQ;UAACc,EAAE,EAAC,UAAU;UAACC,OAAO;QAAA;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAC,CAAC,CAAC;MAC/C;MACA;MACA,oBAAOhB,OAAA,CAACH,QAAQ;QAACc,EAAE,EAAC,GAAG;QAACC,OAAO;MAAA;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,CAAC,CAAC;IACxC;EACJ;;EAEA;EACA,oBAAOhB,OAAA,CAACF,MAAM;IAAAe,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAE,CAAC;AACrB,CAAC;AAACM,EAAA,GAnDIrB,cAAc;AAqDpB,eAAeA,cAAc;AAAC,IAAAqB,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}